<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>randometer.js demo</title>
  <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
  <style>
    .rkm-background {
      background-color: black;
    }
    .rkm-item {
      fill: orange;
    }
  </style>
</head>
<body>
  <script>
    var dataset = [
        ['a', 'b', 'f', 'g'],
        ['Kobe Briant', 'b', 'f', 'x']
    ];
    var h = 500;
    var w = 500;

    var getColumnWidthPercentage = function(n, margin, dividerByColumn) {
      // Solve this equation:
      // 2 * margin + n * x + (n - 1) * x * dividerByColumn = 1
      return (1 - 2 * margin)/(n + (n - 1) * dividerByColumn);
    };

    var getRowHeightPercentage = function(m, marginTop, marginBotton, dividerByRow) {
      return (1 - marginTop - marginBotton)/( m + (m - 1) * dividerByRow);
    }

    var margin = 0.05;
    var marginTop = 0.3;
    var marginBotton = 0.05;

    var dividerByColumn = 0.05;
    var dividerByRow = 0.10;
    var marginPx = margin * w;
    var columnWidthPx = w * getColumnWidthPercentage(dataset.length, margin, dividerByColumn);
    var dividerWidthPx = columnWidthPx * dividerByColumn;
    var m = 4;
    var rowHeightPx = h * getRowHeightPercentage(m, marginTop, marginBotton, dividerByRow);
    var dividerHeightPx = rowHeightPx * dividerByRow;
    var xscale = function(c) {
      return marginPx + c * (columnWidthPx + dividerWidthPx);
    };
    var yscale = function(r) {
      return r * (rowHeightPx + dividerHeightPx);
    };

    var svg = d3.select("body")
            .append("svg")
            .attr("class", "rkm-background")
            .attr("width", w)
            .attr("height", h);
    var groups = svg.selectAll('g.rkm-column')
      .data(dataset)
      .enter()
      .append("g")
      .attr("class", "rmk-column");

    groups.each(function(year_data, year_index) {
      d3.select(this)
        .selectAll("rect.rkm-item")
        .data(year_data)
        .enter()
        .append("rect")
        .attr("class", "rkm-item")
        .attr("x", function(d) {
          return xscale(year_index);
        })
        .attr("y", function(d, i) {
           return yscale(i);
         })
         .attr("width", columnWidthPx)
         .attr("height", 40);

      d3.select(this)
        .selectAll("text.rkm-item-label")
        .data(year_data)
        .enter()
        .append("text")
        .attr("class", "rmk-item-label")
        .attr("x", function(d) {
          return xscale(year_index) + 10;
        })
        .attr("y", function(d, i) {
          return yscale(i) + 20;
        })
        .text(function(d) {
          return d;
        });
    })
  //  svg.selectAll("rect")
  //     .data(dataset[1][1])
  //     .enter()
  //     .append("rect")
  //     .attr("x", function(d, i) {
  //       return 110;
  //     })
  //     .attr("y", function(d, i) {
  //       return i * (40 + 5);
  //     })
  //     .attr("width", 100)
  //     .attr("height", 40);
  </script>
</body>
